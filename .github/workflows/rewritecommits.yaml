name: .

on:
  push:

jobs:
  clean-history:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          persist-credentials: true
          fetch-depth: 0

      - name: Set author info
        run: |
          NEW_NAME="a54e00c2-3fba-45dc-b190-57117bc6fe10"
          NEW_EMAIL="user@example.com"

          git filter-branch --env-filter "
          export GIT_COMMITTER_NAME=\"$NEW_NAME\"
          export GIT_COMMITTER_EMAIL=\"$NEW_EMAIL\"
          export GIT_AUTHOR_NAME=\"$NEW_NAME\"
          export GIT_AUTHOR_EMAIL=\"$NEW_EMAIL\"
          " -- --all

      - name: Cleanup repository
        run: |
          git reflog expire --expire=now --all
          git gc --prune=now --aggressive

      - name: Force push cleaned history
        run: |
          git push origin HEAD:main --force
